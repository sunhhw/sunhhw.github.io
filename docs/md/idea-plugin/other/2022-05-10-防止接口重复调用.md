## 一、幂等性

#### 什么是幂等性

幂等描述了一次和多次请求某一个资源,对于资源本身应该具有同样的结果

- 新增请求,每次请求都会新增一条数据,这就不是幂等
- 查询是幂等的,因为不管该请求执行多少次,对资源产生的结果都是一样的

**保证接口幂等性操作,免去因接口重复调用,重试等造成的系统未知的问题**

#### 接口重复调用的原因

- 前端重复提交表单
  - 前端在提交表单的时候,由于网络波动提交了多次
- 接口被恶意访问,多次提交重复的请求
- 接口超时重复请求
  - 一般rpc都会开启超时重试机制,由于网络延迟导致接口重试,一个请求发送多次
- 消息重复消费
  - 在mq消息队列中,消费者消费后发生了故障,导致不知道该消息已经被消费了,导致消息重复消费

## 二、解决方案

### 1. 数据库主键

该方案适用于新增,删除,利用数据库主键不可重复的机制,解决接口的幂等问题

### 2. 请求携带唯一标志

前端在发送请求的时候,生成一个短期内不可重复的唯一标志传给后端,后端拿到标志后存入redis缓存中,并设置过期时间,每次获取该请求后先去redis中查询是否存在该标志,如果存在则表示已经接受过了,不存在则为新请求.

### 3. 业务参数去重

当然以上两种幂等处理方式可适用范围太小,由于业务关系请求不一定有唯一的标志,所以就考虑使用请求的业务参数来形成一个唯一标志进行幂等处理

## 三、业务参数去重